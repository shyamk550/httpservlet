<#-- ===================== ALLOCATION ===================== -->

<#-- Common header printer for allocation subsections -->
<#macro allocHeader subLabel>
  <@printRow values=[
    "Section","Sub-Section","Account","Securities","Allocation (%)"
  ]/>
</#macro>

<#-- Helper to print one allocation list (if present) -->
<#macro allocBlock subLabel rows>
  <#if rows?? && rows?has_content>
    ${ row(["Allocation"]) }<#t>
    <@allocHeader subLabel=subLabel/>
    <#list rows as r>
      <@printRow values=[
        "Allocation",
        subLabel,
        accountNumber!'',
        (r.securities!'' )?string?replace("&amp;","&"),
        (r.endingAllocationValue!'')?string
      ]/>
    </#list>
  </#if>
</#macro>

<#-- Asset Class (what you already add as allocationAssetClassData) -->
<#if includeAllocationAssetClassTemplate?? && includeAllocationAssetClassTemplate>
  <@allocBlock subLabel="Asset Class" rows=allocationAssetClassData![]/>
</#if>

<#-- Style (only if you later add it to the context as allocationStyleData) -->
<@allocBlock subLabel="Style"  rows=allocationStyleData![]/>

<#-- Sector (only if present) -->
<@allocBlock subLabel="Sector" rows=allocationSectorData![]/>

<#-- Region (only if present) -->
<@allocBlock subLabel="Region" rows=allocationRegionData![]/>

<#-- Optional summary line for Asset Class -->
<#if allocationAssetClassEndingPercent?? || allocationAssetClassEndingValue??>
  <@printRow values=[
    "Allocation","Asset Class Summary",accountNumber!'',
    allocationAssetClassEndingPercent!?string,  /* e.g., "100.3773" */
    allocationAssetClassEndingValue!?string      /* e.g., fair value */
  ]/>
</#if>
